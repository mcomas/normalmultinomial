---
title: "Fitting a sample"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Fitting a sample}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r, include=FALSE}
options(width=180)
```

#### Generating a dataset

First we load the library and fix a seed.

```{r}
library(normalmultinomial)
set.seed(2)
```

We are going to generate a sample coming from a normal-multinomial distribution with the following parameters:

```{r}
#Paramaters
N = 20  # Number of observations
Mu = c(4, 0)
Sigma = matrix(c(1, -0.75,
                 -0.75, 1), nrow=2)
Size = sample(10:50, N, replace=TRUE) # Countings for each observation
```

To generate a sample we can use the function `rnorm.multinom`.

```{r}
X = rnorm.multinom(N, Mu, Sigma, Size = Size)
```

The first rows are:

```{r, echo=FALSE, results='asis'}
knitr::kable(head(X), col.names = c('X1', 'X2','X3'))
```

The dataset represented in the ternary diagram looks like:

```{r}
compositions::plot.rcomp(X)
```

#### Fitting process

To fit a normal-multinomial distribution we can use function `adjustNormalMultinomial`. The function returns a list with different objects. The first two element contain the parameters $\mu$ and $\Sigma$ of the fitted normal-multinomial distribution.


```{r}
fit = adjustNormalMultinomial(X = X)
fit[1:2]
```

The correlation matrix constructed from the covariance matrix is

```{r}
cov2cor(fit[[2]])
```


The third element of list `fit` contains the hidden elements which are more likely to generate the counting `X` under the assumption that `X` was generated by a normal-multinomial distribution.

```{r}
knitr::kable(round(100*head(fit[[3]]),2), col.names = c('X1', 'X2','X3'))
```

The hidden elements represented on the ternary diagram look like

```{r, fig.width=4,  fig.show='hold'}
compositions::plot.rcomp(X)
compositions::plot.acomp(fit[[3]])
```

```{r}
plot(compositions::ilr(fit[[3]]))
```